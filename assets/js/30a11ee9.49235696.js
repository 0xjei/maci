"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9427],{1570:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>c,metadata:()=>o,toc:()=>l});var n=t(5250),i=t(2459);const c={title:"Core",sidebar_label:"Core"},r=void 0,o={id:"typedoc/core/index",title:"Core",description:"NPM Package",source:"@site/versioned_docs/version-v1.x/typedoc/core/index.md",sourceDirName:"typedoc/core",slug:"/typedoc/core/",permalink:"/docs/typedoc/core/",draft:!1,unlisted:!1,editUrl:"https://github.com/privacy-scaling-explorations/maci/edit/dev/website/versioned_docs/version-v1.x/typedoc/core/index.md",tags:[],version:"v1.x",frontMatter:{title:"Core",sidebar_label:"Core"},sidebar:"version-1.x/mySidebar",previous:{title:"VerifyArgs",permalink:"/docs/typedoc/cli/interfaces/VerifyArgs"},next:{title:"module",permalink:"/docs/typedoc/core/modules"}},a={},l=[{value:"Overview",id:"overview",level:2},{value:"<code>MaciState</code>",id:"macistate",level:2},{value:"Key functions",id:"key-functions",level:3},{value:"<strong><code>signUp</code></strong>",id:"signup",level:4},{value:"<strong><code>deployPoll</code></strong>",id:"deploypoll",level:4},{value:"Helper functions",id:"helper-functions",level:3},{value:"<strong><code>copy</code></strong>",id:"copy",level:4},{value:"Key data structures",id:"key-data-structures",level:3},{value:"<strong><code>stateTree</code></strong>",id:"statetree",level:4},{value:"<strong><code>Poll</code></strong>",id:"poll",level:2},{value:"Key functions",id:"key-functions-1",level:3},{value:"<strong><code>publishMessage</code></strong>",id:"publishmessage",level:4},{value:"<strong><code>processMessages</code></strong>",id:"processmessages",level:4},{value:"<strong><code>tallyVotes</code></strong>",id:"tallyvotes",level:4},{value:"Helper functions",id:"helper-functions-1",level:3},{value:"<strong><code>copy</code></strong>",id:"copy-1",level:4},{value:"Key data structures",id:"key-data-structures-1",level:3},{value:"<strong><code>messageTree</code></strong>",id:"messagetree",level:4},{value:"Testing",id:"testing",level:2},{value:"Directory Structure",id:"directory-structure",level:2}];function d(e){const s={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.a,{href:"https://www.npmjs.com/package/maci-core",children:(0,n.jsx)(s.img,{src:"https://img.shields.io/npm/v/maci-core.svg",alt:"NPM Package"})}),"\n",(0,n.jsx)(s.a,{href:"https://github.com/privacy-scaling-explorations/maci/actions?query=workflow%3Acore",children:(0,n.jsx)(s.img,{src:"https://github.com/privacy-scaling-explorations/maci/actions/workflows/core-build.yml/badge.svg",alt:"Actions Status"})})]}),"\n",(0,n.jsx)(s.p,{children:"This submodule assists with handling key business logic functions and\nprocesses."}),"\n",(0,n.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,n.jsx)(s.p,{children:"One may conceive of MACI as a state machine with 1) data and 2) functions which\ntransform said data. This makes it easier to reason about the system, write\ntests, and implement functionality. It also allows us to implement the smart\ncontracts in discrete components which are easy to test."}),"\n",(0,n.jsxs)(s.p,{children:["To this end, this submodule exposes a ",(0,n.jsx)(s.code,{children:"MaciState"})," class and a ",(0,n.jsx)(s.code,{children:"Poll"})," class.\nDevelopers should instantiate objects from these classes to test MACI. For\ninstance, ",(0,n.jsx)(s.a,{href:"https://github.com/privacy-scaling-explorations/maci/blob/dev/contracts/tests/MACI.test.ts",children:(0,n.jsx)(s.code,{children:"MACI.test.ts"})})," creates a\n",(0,n.jsx)(s.code,{children:"MaciState"})," object and every time it interacts with the MACI smart contract, it\nmirrors said interaction on the ",(0,n.jsx)(s.code,{children:"MaciState"})," and ",(0,n.jsx)(s.code,{children:"Poll"}),". As such, the developer\ncan then use their helper functions like ",(0,n.jsx)(s.code,{children:"maciState.signUp()"}),",\n",(0,n.jsx)(s.code,{children:"poll.publishMessage"}),", ",(0,n.jsx)(s.code,{children:"poll.processMessages()"}),", and ",(0,n.jsx)(s.code,{children:"poll.tallyVotes()"})," to\nstep through the various stages of the MACI flow."]}),"\n",(0,n.jsx)(s.h2,{id:"macistate",children:(0,n.jsx)(s.code,{children:"MaciState"})}),"\n",(0,n.jsx)(s.h3,{id:"key-functions",children:"Key functions"}),"\n",(0,n.jsx)(s.h4,{id:"signup",children:(0,n.jsx)(s.strong,{children:(0,n.jsx)(s.code,{children:"signUp"})})}),"\n",(0,n.jsx)(s.p,{children:"Accepts a user's public key and creates a new state leaf and ballot leaf."}),"\n",(0,n.jsxs)(s.p,{children:["In testing, whenever a test suite submits a ",(0,n.jsx)(s.code,{children:"signUp()"})," transaction, it should\ncall ",(0,n.jsx)(s.code,{children:"maciState.signUp()"})," as well, so that the off-chain representation of MACI\nis kept up to date."]}),"\n",(0,n.jsxs)(s.p,{children:["In production, ",(0,n.jsx)(s.code,{children:"genMaciStateFromContract()"})," in\n",(0,n.jsx)(s.a,{href:"https://github.com/privacy-scaling-explorations/maci/blob/dev/contracts/ts/genMaciState.ts",children:(0,n.jsx)(s.code,{children:"genMaciState.ts"})})," uses this function when it\nscans a MACI contract's event log for signups, so as to bring its ",(0,n.jsx)(s.code,{children:"MaciState"}),"\ninstance up to date."]}),"\n",(0,n.jsx)(s.h4,{id:"deploypoll",children:(0,n.jsx)(s.strong,{children:(0,n.jsx)(s.code,{children:"deployPoll"})})}),"\n",(0,n.jsxs)(s.p,{children:["Creates a new ",(0,n.jsx)(s.code,{children:"Poll"}),". This should be done whenever the MACI contract's\n",(0,n.jsx)(s.code,{children:"deployPoll()"})," function is called."]}),"\n",(0,n.jsx)(s.h3,{id:"helper-functions",children:"Helper functions"}),"\n",(0,n.jsx)(s.h4,{id:"copy",children:(0,n.jsx)(s.strong,{children:(0,n.jsx)(s.code,{children:"copy"})})}),"\n",(0,n.jsx)(s.p,{children:"A function that deep-copies an object."}),"\n",(0,n.jsx)(s.h3,{id:"key-data-structures",children:"Key data structures"}),"\n",(0,n.jsx)(s.h4,{id:"statetree",children:(0,n.jsx)(s.strong,{children:(0,n.jsx)(s.code,{children:"stateTree"})})}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.code,{children:"stateTree"})," is a quinary Merkle tree, chosen over a binary tree due to the gas and circuit constraints associated with the Poseidon hash function (",(0,n.jsx)(s.a,{href:"https://ethresear.ch/t/gas-and-circuit-constraint-benchmarks-of-binary-and-quinary-incremental-merkle-trees-using-the-poseidon-hash-function/7446",children:"details here"}),"). Each leaf in this tree represents a participant's public key, their voice credit balance and the block timestamp at which they signed up. The tree features a configurable depth and an arity of five, with insertions starting at index 1. The zeroth leaf is reserved as a security measure against denial-of-service attacks."]}),"\n",(0,n.jsx)(s.h2,{id:"poll",children:(0,n.jsx)(s.strong,{children:(0,n.jsx)(s.code,{children:"Poll"})})}),"\n",(0,n.jsxs)(s.p,{children:["A ",(0,n.jsx)(s.code,{children:"Poll"})," is an off-chain representation of a Poll. In testing, ",(0,n.jsx)(s.code,{children:"Poll"})," instances\nshould mirror their on-chain counterparts."]}),"\n",(0,n.jsx)(s.h3,{id:"key-functions-1",children:"Key functions"}),"\n",(0,n.jsx)(s.h4,{id:"publishmessage",children:(0,n.jsx)(s.strong,{children:(0,n.jsx)(s.code,{children:"publishMessage"})})}),"\n",(0,n.jsx)(s.p,{children:"Publishes a message by updating the message tree and message accumulation\nqueue."}),"\n",(0,n.jsx)(s.h4,{id:"processmessages",children:(0,n.jsx)(s.strong,{children:(0,n.jsx)(s.code,{children:"processMessages"})})}),"\n",(0,n.jsxs)(s.p,{children:["Processes a batch of messages and returns the inputs to the ",(0,n.jsx)(s.code,{children:"processMessages"}),"\ncircuit which can be used to prove correct execution."]}),"\n",(0,n.jsx)(s.h4,{id:"tallyvotes",children:(0,n.jsx)(s.strong,{children:(0,n.jsx)(s.code,{children:"tallyVotes"})})}),"\n",(0,n.jsxs)(s.p,{children:["Tallies a batch of votes and returns the inputs to the ",(0,n.jsx)(s.code,{children:"tallyVotes"}),"\ncircuit which can be used to prove correct execution."]}),"\n",(0,n.jsx)(s.h3,{id:"helper-functions-1",children:"Helper functions"}),"\n",(0,n.jsx)(s.h4,{id:"copy-1",children:(0,n.jsx)(s.strong,{children:(0,n.jsx)(s.code,{children:"copy"})})}),"\n",(0,n.jsx)(s.p,{children:"Deep-copies and returns this object."}),"\n",(0,n.jsx)(s.h3,{id:"key-data-structures-1",children:"Key data structures"}),"\n",(0,n.jsx)(s.h4,{id:"messagetree",children:(0,n.jsx)(s.strong,{children:(0,n.jsx)(s.code,{children:"messageTree"})})}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.code,{children:"messageTree"})," is also a quinary Merkle tree. Each message in this tree represents an encrypted command, such as a user casting a vote in a poll or changing their public key."]}),"\n",(0,n.jsx)(s.h2,{id:"testing",children:"Testing"}),"\n",(0,n.jsxs)(s.p,{children:["For more details about testing please refer to the ",(0,n.jsx)(s.a,{href:"https://maci.pse.dev/docs/testing",children:"tests documentation"}),"."]}),"\n",(0,n.jsx)(s.h2,{id:"directory-structure",children:"Directory Structure"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"ts/"}),": The home for our core classes, ",(0,n.jsx)(s.code,{children:"MaciState"})," and ",(0,n.jsx)(s.code,{children:"Poll"})]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"ts/utls/"}),": Contains supporting utilities"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"ts/__tests__/"}),": A dedicated test suite directory"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,i.a)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},2459:(e,s,t)=>{t.d(s,{Z:()=>o,a:()=>r});var n=t(79);const i={},c=n.createContext(i);function r(e){const s=n.useContext(c);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),n.createElement(c.Provider,{value:s},e.children)}}}]);