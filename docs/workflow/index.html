<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-v1.x docs-doc-page docs-doc-id-workflow" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">MACI Workflow | MACI</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://maci.pse.dev/img/maci-card.png"><meta data-rh="true" name="twitter:image" content="https://maci.pse.dev/img/maci-card.png"><meta data-rh="true" property="og:url" content="https://maci.pse.dev/docs/workflow"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="v1.x"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v1.x"><meta data-rh="true" name="docsearch:version" content="v1.x"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v1.x"><meta data-rh="true" property="og:title" content="MACI Workflow | MACI"><meta data-rh="true" name="description" content="Overview of the MACI workflow"><meta data-rh="true" property="og:description" content="Overview of the MACI workflow"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://maci.pse.dev/docs/workflow"><link data-rh="true" rel="alternate" href="https://maci.pse.dev/docs/workflow" hreflang="en"><link data-rh="true" rel="alternate" href="https://maci.pse.dev/docs/workflow" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="MACI RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="MACI Atom Feed">





<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.3efc238b.css">
<script src="/assets/js/runtime~main.a3e149da.js" defer="defer"></script>
<script src="/assets/js/main.ac5cf4d3.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_ML3d" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">MACI</b></a><a class="navbar__item navbar__link" href="/docs/introduction">Documentation</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/roadmap">Roadmap</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/introduction">v1.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/workflow">v1.x</a></li><li><a class="dropdown__link" href="/docs/v0.x/introduction">v0.x</a></li></ul></div><div class="navbarSearchContainer_qEKT"><div class="navbar__search searchBarContainer_NuUV"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_B52I searchBarLoadingRing_of1z"><div></div><div></div><div></div><div></div></div></div></div><a href="https://github.com/privacy-scaling-explorations/maci" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_zI7a"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_a2Ef colorModeToggle_J33C"><button class="clean-btn toggleButton_K7OJ toggleButtonDisabled_JIWS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_X1z7"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wOoS"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_aR1s"><div class="docsWrapper_d1tO"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_CI3s" type="button"></button><div class="docRoot_Ec1W"><aside class="theme-doc-sidebar-container docSidebarContainer_Cazd"><div class="sidebarViewport_XsVM"><div class="sidebar_Iuzv"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_tEnT"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/purpose">Purpose</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/workflow">Workflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/primitives">Primitives</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cli">Command-line interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/contracts">Smart Contracts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/circuits">Circuits</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/trusted-setup">Trusted Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/testing">Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/testing-in-detail">Testing in detail</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/integrating">Integrating</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/audit">Security audits</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/ci-pipeline">CI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/coordinator-processing">Coordinator local processing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/spec">Specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/key-change">Key change</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/versioning">MACI versioning</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/contributing/">Contributing</a><button aria-label="Expand sidebar category &#x27;Contributing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/poll-types">MACI poll types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/topup">Topup</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/solidity-docs/">Solidity Docs</a><button aria-label="Expand sidebar category &#x27;Solidity Docs&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/typedoc/">Typedoc</a><button aria-label="Expand sidebar category &#x27;Typedoc&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_Aw6Y"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_mQIU"><div class="docItemContainer_IWC5"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_S2jZ" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_E5cy"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Workflow</span><meta itemprop="position" content="1"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v1.x</span><div class="tocCollapsible_IFRJ theme-doc-toc-mobile tocMobile_l9eB"><button type="button" class="clean-btn tocCollapsibleButton_swoQ">On this page</button></div><div class="theme-doc-markdown markdown"><h1>MACI Workflow</h1>
<p>This article covers the high-level MACI workflow, which borrows heavily from our <a href="/blog/maci-1-0-technical-introduction#system-overview">Technical Introduction to MACI</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_I2WF" id="roles">Roles<a href="#roles" class="hash-link" aria-label="Direct link to Roles" title="Direct link to Roles">​</a></h2>
<p>There are two key roles that participate in MACI:</p>
<ol>
<li>Users, who vote on polls</li>
<li>A trusted coordinator, who configures and launches polls, tallies up votes, and publishes the final results</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_I2WF" id="user-voter">User (voter)<a href="#user-voter" class="hash-link" aria-label="Direct link to User (voter)" title="Direct link to User (voter)">​</a></h3>
<p>A &quot;User&quot; is any voter in a MACI poll.</p>
<p>In order to participate in a MACI poll, a user will perform at least 2 on-chain transactions:</p>
<ol>
<li>Sign up with MACI</li>
<li>Vote on a poll</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_I2WF" id="coordinator">Coordinator<a href="#coordinator" class="hash-link" aria-label="Direct link to Coordinator" title="Direct link to Coordinator">​</a></h3>
<p>The &quot;Coordinator&quot; helps set up and execute MACI polls. They are responsible for deploying the MACI smart contracts, initiating polls, tallying the final results of a vote, and finalizing polls by publishing the final results on-chain.</p>
<div class="theme-admonition theme-admonition-info admonition_cYif alert alert--info"><div class="admonitionHeading_fPDr"><span class="admonitionIcon_d_zO"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_vEJX"><p>Note: it&#x27;s possible for the contract deployer and the coordinator to be two separate accounts/entities, but for simplicity we&#x27;ll start by assuming these functions are the same role.</p></div></div>
<p>Once a voting poll has completed (i.e. the voting deadline has elapsed), the coordinator has the sole ability to decrypt all user votes and tally up the total results. The coordinator then publishes commitments and proofs of these results on chain to finalize a poll. The coordinators must use zk-SNARKs proofs to guarantee that their final tally result is valid, and this is accomplished without releasing the vote of every individual.</p>
<h4 class="anchor anchorWithStickyNavbar_I2WF" id="trust-assumptions">Trust assumptions<a href="#trust-assumptions" class="hash-link" aria-label="Direct link to Trust assumptions" title="Direct link to Trust assumptions">​</a></h4>
<p>We say the coordinator is a &quot;trusted&quot; coordinator, because there&#x27;s areas where a corrupt (or inept) coordinator could disrupt the &quot;happy path&quot; of the MACI workflow.</p>
<p>For instance, a coordinator can:</p>
<ul>
<li>Decrypt votes (in order to publish them, or to bribe individual voters)</li>
<li>Halt a round (by never tallying results or never submitting the final proofs)</li>
</ul>
<p>A coordinator cannot:</p>
<ul>
<li>Publish incorrect results (either by censoring valid votes or creating fraudulent votes)</li>
<li>Change the parameters of a poll (e.g. by extending its voting deadline once it&#x27;s been deployed)</li>
</ul>
<p>Therefore, even if a coordinator is corrupt, they are unable to change a user’s vote or add extra votes themselves. A corrupt coordinator can stop a vote by never publishing the results, but they can’t publish false results.</p>
<h2 class="anchor anchorWithStickyNavbar_I2WF" id="contracts">Contracts<a href="#contracts" class="hash-link" aria-label="Direct link to Contracts" title="Direct link to Contracts">​</a></h2>
<p>To explain the MACI workflow, let&#x27;s give a quick overview of the key smart contracts.</p>
<p>See our <a href="/docs/contracts">smart contract docs</a> or our <a href="https://github.com/privacy-scaling-explorations/maci/tree/dev/contracts/contracts" target="_blank" rel="noopener noreferrer">contract source code</a> for a more in-depth explanation of all smart contracts.</p>
<h3 class="anchor anchorWithStickyNavbar_I2WF" id="macisol">MACI.sol<a href="#macisol" class="hash-link" aria-label="Direct link to MACI.sol" title="Direct link to MACI.sol">​</a></h3>
<p>The MACI contract is responsible for registering user signups by recording the initial public key for each user (via the <a href="/docs/solidity-docs/MACI#signup-1"><code>signUp</code> function</a>). To conduct a voting round, the coordinator can deploy a Poll via MACI (with the <a href="/docs/solidity-docs/MACI#deploypoll"><code>deployPoll</code> function</a>).</p>
<h3 class="anchor anchorWithStickyNavbar_I2WF" id="pollsol">Poll.sol<a href="#pollsol" class="hash-link" aria-label="Direct link to Poll.sol" title="Direct link to Poll.sol">​</a></h3>
<p>The Poll contract is where users submit their votes (via the <a href="/docs/typedoc/core/classes/Poll#publishmessage"><code>publishMessage</code> function</a>). One MACI contract can be used for multiple Poll contracts. In other words, a user that signed up to the MACI contract can vote on multiple issues, with each issue represented by a distinct Poll contract.</p>
<h3 class="anchor anchorWithStickyNavbar_I2WF" id="messageprocessorsol-and-tallysol">MessageProcessor.sol and Tally.sol<a href="#messageprocessorsol-and-tallysol" class="hash-link" aria-label="Direct link to MessageProcessor.sol and Tally.sol" title="Direct link to MessageProcessor.sol and Tally.sol">​</a></h3>
<p>The MessageProcessor and Tally contracts are used by the coordinator to process all user votes and to prove on-chain that they correctly tallied each vote.</p>
<h2 class="anchor anchorWithStickyNavbar_I2WF" id="poll-lifecycle">Poll lifecycle<a href="#poll-lifecycle" class="hash-link" aria-label="Direct link to Poll lifecycle" title="Direct link to Poll lifecycle">​</a></h2>
<p>As described above, a core contract of MACI is a Poll. Coordinators can deploy polls and add vote options to polls, which users can then vote on. Although each instance of MACI can deploy multiple Polls, only one Poll can be active at a time.</p>
<p>In essence, each MACI Poll is a state machine which has 3 stages:</p>
<ol>
<li>Open</li>
<li>Closed</li>
<li>Finalized</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_I2WF" id="1-open">1) Open<a href="#1-open" class="hash-link" aria-label="Direct link to 1) Open" title="Direct link to 1) Open">​</a></h3>
<p>When a Poll is deployed, its voting period starts immediately. As part of its deployment, the <code>duration</code> of the Poll is set, which determines how long the Poll is open for voting. A Poll is &quot;open&quot; until the duration of the Poll has elapsed.</p>
<p>During this stage, users can sign up and vote.</p>
<h4 class="anchor anchorWithStickyNavbar_I2WF" id="sign-up">Sign up<a href="#sign-up" class="hash-link" aria-label="Direct link to Sign up" title="Direct link to Sign up">​</a></h4>
<p>Before a user can cast a vote, they must sign up by generating a MACI keypair and then sending the public key they wish to use to cast their vote to the MACI smart contract. This MACI public key (distinct from their Ethereum account public key) acts as their identity when voting. Users can vote from any Ethereum address, but their message must contain a signature from that MACI public key.</p>
<p>This registration process is necessary to fortify MACI against Sybil attacks. The particular criteria used to allow user signups is customizable, and can be configured using any <a href="https://github.com/privacy-scaling-explorations/maci/blob/dev/contracts/contracts/gatekeepers/SignUpGatekeeper.sol" target="_blank" rel="noopener noreferrer">SignUpGatekeeper contract</a>. This contract dictates the criteria a user must pass in order to participate in a poll. For example, a user might need to prove ownership of a certain NFT, or that they&#x27;ve received some attestation on EAS, or prove that they have passed some sort of proof-of-personhood verification. Note that MACI presumes an identity system where each legitimate member
controls a unique private key - MACI does not specifically solve for this, but allows for customization on how this is configured.</p>
<h4 class="anchor anchorWithStickyNavbar_I2WF" id="vote">Vote<a href="#vote" class="hash-link" aria-label="Direct link to Vote" title="Direct link to Vote">​</a></h4>
<p>Once a user has signed up with MACI, they are eligible to vote on open polls.</p>
<p>To cast a vote, a user will bundle a few variables — including a public key, their vote option, their vote amount, and a few others — into what is called a &quot;command&quot;. Then, the user signs the command with the public key they originally used to sign up. After that, the user encrypts the signature and command together so that it is now considered a &quot;message&quot;. If the command is properly signed by the user’s MACI public key, then the message is considered valid will be counted in the final tally. Therefore, the MACI public key can be thought of as the user’s voting username, and the signature is the voting password. If they provide the correct signature, they can submit a vote.</p>
<p>Before sending their vote on-chain, users encrypt their vote using a shared key that only the user and coordinator can know. This key scheme is designed so that every individual user shares a distinct key with the coordinator. This prevents any bribers from simply reading the transaction data to see which option a user voted for. It also allows the coordinator to decrypt user votes (so that they can tally the results).</p>
<h3 class="anchor anchorWithStickyNavbar_I2WF" id="2-closed">2) Closed<a href="#2-closed" class="hash-link" aria-label="Direct link to 2) Closed" title="Direct link to 2) Closed">​</a></h3>
<p>A Poll is &quot;closed&quot;, when the voting period ends. At this point, no users may submit any more votes. The Poll remains closed until the coordinator tallies the final results.</p>
<p>At this point, the coordinator must process all the messages, tally the results, and publish the proofs on-chain.</p>
<h4 class="anchor anchorWithStickyNavbar_I2WF" id="process-messages">Process Messages<a href="#process-messages" class="hash-link" aria-label="Direct link to Process Messages" title="Direct link to Process Messages">​</a></h4>
<p>Once the voting period has completed for a specific poll, the coordinator will use the <code>MessageProcessor</code> contract to first prove that they have correctly decrypted each message and applied them to correctly create an updated state tree. This state tree keeps an account of all the valid votes that should be counted. So, when processing the messages, the coordinator will not keep messages that are later overridden by a newer message inside the state tree. For example, if a user votes for option A, but then later sends a new message to vote for option B, the coordinator will only count the vote for option B.</p>
<p>The coordinator must process messages in batches so that proving on chain does not exceed the data limit. The coordinator then creates a zk-SNARK proving their state tree correctly contains only the valid messages. Once the proof is ready, the coordinator calls <a href="/docs/solidity-docs/MessageProcessor#processmessages"><code>MessageProcessor.processMessages()</code></a>, providing a hash of the state tree and the zk-SNARK proof as an input parameters.</p>
<p>The <code>MessageProcessor</code> contract will send the proof to a separate verifier contract. The verifier contract is specifically built to read MACI zk-SNARK proofs and tell if they are valid or not. So, if the verifier contract returns true, then everyone can see on-chain that the coordinator correctly processed that batch of messages. The coordinator repeats this process until all messages have been processed.</p>
<h4 class="anchor anchorWithStickyNavbar_I2WF" id="tally-results">Tally Results<a href="#tally-results" class="hash-link" aria-label="Direct link to Tally Results" title="Direct link to Tally Results">​</a></h4>
<p>Finally, once all messages have been processed, the coordinator tallies the votes of the valid messages (off-chain). The coordinator creates a zk-SNARK proving that the valid messages in the state tree (proved in Process Messages step) contain votes that sum to the given tally result. Then, they call <a href="/docs/solidity-docs/Tally#tallyvotes"><code>Tally.tallyVotes()</code></a> with a hash of the correct tally results and the zk-SNARK proof. Similarly to the processMessages function, the <code>tallyVotes</code> function will send the proof to a verifier contract to ensure that it is valid.</p>
<p>The <code>tallyVotes</code> function is only successful if the verifier contract returns that the proof is valid. Therefore, once the <code>tallyVotes</code> function succeeds, users can trust that the coordinator has correctly tallied all of the valid votes. After this step, anyone can see the final tally results and the proof that these results are a correct result of the messages sent to the Poll contract. The users won’t be able to see how any individual voted, but will be able to trust that these votes were properly processed and counted.</p>
<h3 class="anchor anchorWithStickyNavbar_I2WF" id="3-finalized">3) Finalized<a href="#3-finalized" class="hash-link" aria-label="Direct link to 3) Finalized" title="Direct link to 3) Finalized">​</a></h3>
<p>A poll is &quot;finalized&quot; after the coordinator processes all the messages, tallies the results, and publishes the on-chain proofs.</p>
<p>At this point, the final results of a poll can be announced, and anyone can verify that the results have been processed and calculated correctly by the coordinator.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/privacy-scaling-explorations/maci/edit/dev/website/versioned_docs/version-v1.x/workflow.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_A4i3" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_uNWa"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/purpose"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Purpose</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_DN96 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#roles" class="table-of-contents__link toc-highlight">Roles</a><ul><li><a href="#user-voter" class="table-of-contents__link toc-highlight">User (voter)</a></li><li><a href="#coordinator" class="table-of-contents__link toc-highlight">Coordinator</a></li></ul></li><li><a href="#contracts" class="table-of-contents__link toc-highlight">Contracts</a><ul><li><a href="#macisol" class="table-of-contents__link toc-highlight">MACI.sol</a></li><li><a href="#pollsol" class="table-of-contents__link toc-highlight">Poll.sol</a></li><li><a href="#messageprocessorsol-and-tallysol" class="table-of-contents__link toc-highlight">MessageProcessor.sol and Tally.sol</a></li></ul></li><li><a href="#poll-lifecycle" class="table-of-contents__link toc-highlight">Poll lifecycle</a><ul><li><a href="#1-open" class="table-of-contents__link toc-highlight">1) Open</a></li><li><a href="#2-closed" class="table-of-contents__link toc-highlight">2) Closed</a></li><li><a href="#3-finalized" class="table-of-contents__link toc-highlight">3) Finalized</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction">Documentation</a></li><li class="footer__item"><a href="https://github.com/privacy-scaling-explorations/maci" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_zI7a"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.com/invite/sF5CT5rzrR" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_zI7a"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/zkMACI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_zI7a"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Privacy and Scaling Explorations</div></div></div></footer></div>
</body>
</html>