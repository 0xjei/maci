<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-v1.x docs-doc-page docs-doc-id-testing-in-detail" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">MACI Testing in Detail | MACI</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://maci.pse.dev/img/maci-card.png"><meta data-rh="true" name="twitter:image" content="https://maci.pse.dev/img/maci-card.png"><meta data-rh="true" property="og:url" content="https://maci.pse.dev/docs/testing-in-detail"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="v1.x"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v1.x"><meta data-rh="true" name="docsearch:version" content="v1.x"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v1.x"><meta data-rh="true" property="og:title" content="MACI Testing in Detail | MACI"><meta data-rh="true" name="description" content="How MACI tests work in detail"><meta data-rh="true" property="og:description" content="How MACI tests work in detail"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://maci.pse.dev/docs/testing-in-detail"><link data-rh="true" rel="alternate" href="https://maci.pse.dev/docs/testing-in-detail" hreflang="en"><link data-rh="true" rel="alternate" href="https://maci.pse.dev/docs/testing-in-detail" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="MACI RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="MACI Atom Feed">





<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.53e6675c.css">
<script src="/assets/js/runtime~main.33434d15.js" defer="defer"></script>
<script src="/assets/js/main.308952dc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_gHk8" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">MACI</b></a><a class="navbar__item navbar__link" href="/docs/introduction">Documentation</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/roadmap">Roadmap</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/introduction">v1.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/testing-in-detail">v1.x</a></li><li><a class="dropdown__link" href="/docs/v0.x/introduction">v0.x</a></li></ul></div><div class="navbarSearchContainer_f_7v"><div class="navbar__search searchBarContainer_ZxNh"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_qnKT searchBarLoadingRing_J3vR"><div></div><div></div><div></div><div></div></div></div></div><a href="https://github.com/privacy-scaling-explorations/maci" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink__8iC"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle__YEU colorModeToggle_OTu5"><button class="clean-btn toggleButton_1G_w toggleButtonDisabled_cQrs" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_j1By"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_i9vB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_G2LW"><div class="docsWrapper_wAbx"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_uoUx" type="button"></button><div class="docRoot_iP0R"><aside class="theme-doc-sidebar-container docSidebarContainer_DMxT"><div class="sidebarViewport_kA93"><div class="sidebar_Csac"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_qNd2"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/primitives">Primitives</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cli">Command-line interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/contracts">Smart Contracts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/circuits">Circuits</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/trusted-setup">Trusted Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/testing">Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/testing-in-detail">Testing in detail</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/integrating">Integrating</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/audit">Security Assessments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/ci-pipeline">CI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/coordinator-processing">Coordinator local processing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/spec">Specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/key-change">Key change</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/versioning">MACI versioning</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/contributing/">Contributing</a><button aria-label="Expand sidebar category &#x27;Contributing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/solidity-docs/">Solidity Docs</a><button aria-label="Expand sidebar category &#x27;Solidity Docs&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/typedoc/">Typedoc</a><button aria-label="Expand sidebar category &#x27;Typedoc&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_IMax"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_wOn6"><div class="docItemContainer_R4e_"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Vsgw" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_lsuu"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Testing in detail</span><meta itemprop="position" content="1"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v1.x</span><div class="tocCollapsible_dG2R theme-doc-toc-mobile tocMobile_L0ES"><button type="button" class="clean-btn tocCollapsibleButton_V7FA">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Testing in detail</h1>
<p>This doc expands on our <a href="/docs/testing">introduction to testing</a> doc and explains how MACI tests work in greater detail. This information should be used by MACI&#x27;s maintainers as well as contributors.</p>
<h2 class="anchor anchorWithStickyNavbar_ZXgj" id="automated-tests">Automated Tests<a href="#automated-tests" class="hash-link" aria-label="Direct link to Automated Tests" title="Direct link to Automated Tests">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_ZXgj" id="cli-tests">CLI Tests<a href="#cli-tests" class="hash-link" aria-label="Direct link to CLI Tests" title="Direct link to CLI Tests">​</a></h3>
<p>MACI&#x27;s CLI provides a series of commands that can be used by both the coordinator and voters, to interact with MACI, from deploying smart contracts to submitting a vote.</p>
<p>Currently, there are a number of test cases that are available inside the cli tests folder. The tests are split into two categories:</p>
<ul>
<li>e2e tests that include the entire MACI stack, from deploying the contracts to submitting a vote and tallying all results.</li>
<li>e2e tests as above, but with the subsidy feature enabled.</li>
</ul>
<p>The goal of these tests is to ensure that the MACI stack works as expected, and that the coordinator and voters can interact with the system as expected. They currently do not attempt to verify whether the tally results are expected, or that all votes were accounted for. On the other hand, they test different scenarios, mixing different numbers of voters and messages.</p>
<h3 class="anchor anchorWithStickyNavbar_ZXgj" id="integration-tests">Integration Tests<a href="#integration-tests" class="hash-link" aria-label="Direct link to Integration Tests" title="Direct link to Integration Tests">​</a></h3>
<p>Integration tests follow a similar fashion of the CLI tests, though they also ensure that the tally results are as expected.</p>
<p>Currently, tests are defined using a JSON file, here is one example:</p>
<div class="language-json codeBlockContainer_CK4n theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_dg_R"><pre tabindex="0" class="prism-code language-json codeBlock_j9U3 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_vkny"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;name&quot;: &quot;Happy path&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;description&quot;: &quot;Full tree, 4 batches, no bribers&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;numVotesPerUser&quot;: 1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;numUsers&quot;: 15,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;expectedTally&quot;: [15, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;expectedSpentVoiceCredits&quot;: [15, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;expectedTotalSpentVoiceCredits&quot;: 15</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_WjYH"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_c2HW" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_vQaT"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lAUW"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This test will generate 15 signups (as expressed in <code>numUsers</code>), and submit one vote (<code>numVotesPerUser</code>) for each of the users. As we did not provide any vote detail, it will use the default: <code>weight = 1</code>, <code>option = 0</code> for all voters. This will result of course in a tally result of 15 for option 0, and 0 for all other options.</p>
<p>Finally, the whole process of merging the state and message trees is performed, proofs are generated and the tally result is verified against the expected result.</p>
<h4 class="anchor anchorWithStickyNavbar_ZXgj" id="how-to-implement-a-new-test-case">How to implement a new test case<a href="#how-to-implement-a-new-test-case" class="hash-link" aria-label="Direct link to How to implement a new test case" title="Direct link to How to implement a new test case">​</a></h4>
<p>To add a new test cases, it is quite simple. You can amend the <code>integrationTests/ts/__tests__/data/suites.json</code> file and add your test declaration in there.</p>
<div class="language-json codeBlockContainer_CK4n theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_dg_R"><pre tabindex="0" class="prism-code language-json codeBlock_j9U3 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_vkny"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;name&quot;: &quot;Subsidy test&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;description&quot;: &quot;has subsidy result&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;numUsers&quot;: 4,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;numVotesPerUser&quot;: 1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;votes&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;0&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;0&quot;: { &quot;voteOptionIndex&quot;: 0, &quot;voteWeight&quot;: 1, &quot;valid&quot;: true }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;1&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;0&quot;: { &quot;voteOptionIndex&quot;: 0, &quot;voteWeight&quot;: 1, &quot;valid&quot;: true }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;2&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;0&quot;: { &quot;voteOptionIndex&quot;: 0, &quot;voteWeight&quot;: 1, &quot;valid&quot;: true }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;3&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;0&quot;: { &quot;voteOptionIndex&quot;: 0, &quot;voteWeight&quot;: 1, &quot;valid&quot;: true }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;expectedTally&quot;: [4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;expectedSpentVoiceCredits&quot;: [4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;expectedTotalSpentVoiceCredits&quot;: 4,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;subsidy&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;enabled&quot;: true,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;expectedSubsidy&quot;: [117636, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_WjYH"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_c2HW" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_vQaT"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lAUW"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let&#x27;s look at the fields in detail:</p>
<ul>
<li><code>name</code>: the name of the test case</li>
<li><code>description</code>: a description of the test case</li>
<li><code>numUsers</code>: the number of users to generate</li>
<li><code>numVotesPerUser</code>: the number of votes to generate for each user</li>
<li><code>votes</code>: the votes to generate. This is an object where the key is the user index, and the value is another object where the key is the message index, and the value is the vote details. If you do not provide any vote details, the default will be used: <code>weight = 1</code>, <code>option = 0</code> for all voters.</li>
<li><code>expectedTally</code>: the expected tally result for each vote option (in order)</li>
<li><code>expectedSpentVoiceCredits</code>: the expected spent voice credits for each vote option (in order)</li>
<li><code>expectedTotalSpentVoiceCredits</code>: the expected total spent voice credits</li>
<li><code>subsidy</code>: an object that contains the subsidy details. If you do not provide any subsidy details, the default will be used: <code>enabled = false</code>, <code>expectedSubsidy = []</code>. If you do provide subsidy details, you must provide both fields.</li>
</ul>
<p>As an example, let&#x27;s try to implement a test given the following criterias:</p>
<ol>
<li>We want 10 users to signup</li>
<li>We want each user to publish a different vote</li>
<li>We want to verify that the tally result is as expected</li>
<li>We will not use the subsidy feature</li>
</ol>
<div class="language-json codeBlockContainer_CK4n theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_dg_R"><pre tabindex="0" class="prism-code language-json codeBlock_j9U3 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_vkny"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;name&quot;: &quot;10 Users test&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;description&quot;: &quot;Should signup 10 users, submit 10 votes and tally the results&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;numUsers&quot;: 10,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;numVotesPerUser&quot;: 1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;votes&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;0&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;0&quot;: { &quot;voteOptionIndex&quot;: 0, &quot;voteWeight&quot;: 5 }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;1&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;0&quot;: { &quot;voteOptionIndex&quot;: 0, &quot;voteWeight&quot;: 9 }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;2&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;0&quot;: { &quot;voteOptionIndex&quot;: 5, &quot;voteWeight&quot;: 3 }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;3&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;0&quot;: { &quot;voteOptionIndex&quot;: 3, &quot;voteWeight&quot;: 2 }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;4&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;0&quot;: { &quot;voteOptionIndex&quot;: 0, &quot;voteWeight&quot;: 1 }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;5&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;0&quot;: { &quot;voteOptionIndex&quot;: 9, &quot;voteWeight&quot;: 1 }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;6&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;0&quot;: { &quot;voteOptionIndex&quot;: 4, &quot;voteWeight&quot;: 7 }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;7&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;0&quot;: { &quot;voteOptionIndex&quot;: 7, &quot;voteWeight&quot;: 5 }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;8&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;0&quot;: { &quot;voteOptionIndex&quot;: 3, &quot;voteWeight&quot;: 10 }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;9&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;0&quot;: { &quot;voteOptionIndex&quot;: 8, &quot;voteWeight&quot;: 2 }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;expectedTally&quot;: [15, 0, 0, 12, 7, 3, 0, 5, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;expectedSpentVoiceCredits&quot;: [107, 0, 0, 104, 49, 9, 0, 25, 4, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;expectedTotalSpentVoiceCredits&quot;: 299</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_WjYH"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_c2HW" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_vQaT"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_lAUW"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Why expectedTally as above</strong></p>
<p>[(5 + 9 + 1), 0, 0, (2 + 10), 7, 3, 0, 5, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0] -&gt; [15, 0, 0, 12, 7, 3, 0, 5, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0]</p>
<p><strong>Why 299 voice credits spent</strong></p>
<ul>
<li>5 ** 2 + 9 ** 2 + 3 ** 2 + 2 ** 2 + 1 ** 2 + 1 ** 1 + 7 ** 2 + 5 ** 2 + 10 ** 2 + 2 ** 2 = 25 + 81 + 9 + 4 + 1 + 1 + 49 + 25 + 100 + 4 = 299</li>
</ul>
<p><strong>Why expectedSpentVoiceCredits as above</strong></p>
<p>[(25 + 81 + 1), 0, 0, (4 + 100), 49, 0, 25, 4, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0] -&gt; [107, 0, 0, 104, 49, 0, 25, 4, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</p>
<h4 class="anchor anchorWithStickyNavbar_ZXgj" id="maci-keys-integration-tests">MACI keys integration tests<a href="#maci-keys-integration-tests" class="hash-link" aria-label="Direct link to MACI keys integration tests" title="Direct link to MACI keys integration tests">​</a></h4>
<p>Another test file which is found inside the integration tests folder is the <code>maciKeys.test.ts</code> file. This file contains a number of tests that are used to verify that the MACI keys work as expected. These tests are written in TypeScript and use the <code>mocha</code> and <code>chai</code> frameworks.</p>
<p>They are testing that between the <code>contracts</code>, <code>domainobjs</code> and <code>crypto</code> packages, the MACI keys are working correctly, and are serialized/deserialized as expected. This is particularly important to test due to different data formats for keys, especially when parsed from the smart contract events.</p>
<h3 class="anchor anchorWithStickyNavbar_ZXgj" id="contract-tests">Contract tests<a href="#contract-tests" class="hash-link" aria-label="Direct link to Contract tests" title="Direct link to Contract tests">​</a></h3>
<p>Within the contracts folder, there are a number of tests that are used to verify that the contracts work as expected. These tests are written in TypeScript and use the <code>hardhat</code> framework.</p>
<p>These tests interact with all other packages, such as crypto, domainobjs and core, where mock data comes from. Their main goal is to ensure that the smart contracts have the correct parameters when deployed, privileged functions cannot be called by non-privileged users, and that the contract state is as expected after a series of operations.</p>
<h3 class="anchor anchorWithStickyNavbar_ZXgj" id="circuits-tests">Circuits tests<a href="#circuits-tests" class="hash-link" aria-label="Direct link to Circuits tests" title="Direct link to Circuits tests">​</a></h3>
<p>Within the circuits folder, there are a number of tests that are used to verify that the circuits work as expected. These tests are written in TypeScript and use the <code>circom_tester</code> (which runs on top of <code>mocha</code> and <code>chai</code>).</p>
<p>These tests often use mock data from the <code>core</code> package. For instance, when testing the <code>processMessages</code> circuit, we are required to generate the parameters from the <code>core</code> packing, using the <code>Poll:processMessages</code> function. The same applies to vote tallying, where we need the <code>Poll:tally</code> function to be run first with mock users and vote messages.</p>
<p>All of the tests run using test parameters, usually <code>10, 2, 1, 2</code>, aside from the tests inside: <a href="https://github.com/privacy-scaling-explorations/maci/blob/dev/circuits/ts/__tests__/CeremonyParams.test.ts" target="_blank" rel="noopener noreferrer"><code>ceremonyParam</code></a> which use the parameters of the latest MACI ceremony. More details on the trusted setup can be found <a href="/docs/trusted-setup">here</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_ZXgj" id="core">Core<a href="#core" class="hash-link" aria-label="Direct link to Core" title="Direct link to Core">​</a></h3>
<p>The core package contains a number of tests that are used to verify that the core functions work as expected. These tests are written in TypeScript and use the <code>mocha</code> and <code>chai</code> frameworks.</p>
<p>These tests interact with the crypto and dombinobjs packages, where mock data comes from. Their main goal is to ensure that the core functions work as expected, and that the state is as expected after a series of operations.</p>
<p>Currently, there is a blend of e2e and unit tests, where e2e tests are used to verify that the entire MACI local processing works as expcted (users signup, publish votes, messages are processed and finally these votes are tallied). Unit tests on the other hand are used to verify that the core functions work as expected, such as <code>processMessage</code> and <code>tallyVotes</code>. You will find them in separate files, with e2e being <a href="https://github.com/privacy-scaling-explorations/maci/blob/dev/core/ts/__tests__/e2e.test.ts" target="_blank" rel="noopener noreferrer">here</a> and unit tests in the other files.</p>
<h3 class="anchor anchorWithStickyNavbar_ZXgj" id="domainobjscrypto-tests">Domainobjs/Crypto tests<a href="#domainobjscrypto-tests" class="hash-link" aria-label="Direct link to Domainobjs/Crypto tests" title="Direct link to Domainobjs/Crypto tests">​</a></h3>
<p>These tests are used to verify that MACI&#x27;s primitives such as private keys work as expected. They are written in TypeScript and use the <code>mocha</code> and <code>chai</code> frameworks.</p>
<h2 class="anchor anchorWithStickyNavbar_ZXgj" id="manual-testing">&quot;Manual&quot; Testing<a href="#manual-testing" class="hash-link" aria-label="Direct link to &quot;Manual&quot; Testing" title="Direct link to &quot;Manual&quot; Testing">​</a></h2>
<p>To ensure that the MACI stack works as expected, without having to run the entire test suite (or even just the e2e tests), there is a <a href="https://github.com/privacy-scaling-explorations/maci/blob/dev/cli/testScript.sh" target="_blank" rel="noopener noreferrer">bash script</a> inside the cli folder which can be used.</p>
<p>This script contains a number of actions which touch all of the parts of MACI, and resemble exactly what other e2e tests do.</p>
<p>Looking at this in more details we do the following:</p>
<ol>
<li>Deploy a <code>VkRegistry</code> contract</li>
<li>Set the verification keys on this smart contract</li>
<li>Deploy a <code>MACI</code> contract (and associated utility contracts)</li>
<li>Deploy a Poll from the MACI contract.</li>
<li>Signup 1 user</li>
<li>Publish 2 messages</li>
<li>Travel in time (local blockchain node) to arrive at the end of the poll</li>
<li>Merge the signups tree</li>
<li>Merge the messages tree</li>
<li>Generate proofs for the message processing and vote tallying</li>
<li>Update the on chain state</li>
<li>Verify that proofs and tally are correct</li>
</ol>
<p>The above is the minimum required to ensure that the stack works as expected, as it encompasses actions from both voters and the coordinator.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/privacy-scaling-explorations/maci/edit/dev/website/versioned_docs/version-v1.x/testing-in-detail.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_nxsq" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_F5Kg"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/testing"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Testing</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/integrating"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Integrating</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_qL5N thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#automated-tests" class="table-of-contents__link toc-highlight">Automated Tests</a><ul><li><a href="#cli-tests" class="table-of-contents__link toc-highlight">CLI Tests</a></li><li><a href="#integration-tests" class="table-of-contents__link toc-highlight">Integration Tests</a></li><li><a href="#contract-tests" class="table-of-contents__link toc-highlight">Contract tests</a></li><li><a href="#circuits-tests" class="table-of-contents__link toc-highlight">Circuits tests</a></li><li><a href="#core" class="table-of-contents__link toc-highlight">Core</a></li><li><a href="#domainobjscrypto-tests" class="table-of-contents__link toc-highlight">Domainobjs/Crypto tests</a></li></ul></li><li><a href="#manual-testing" class="table-of-contents__link toc-highlight">&quot;Manual&quot; Testing</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction">Documentation</a></li><li class="footer__item"><a href="https://github.com/privacy-scaling-explorations/maci" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink__8iC"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.com/invite/sF5CT5rzrR" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink__8iC"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/zkMACI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink__8iC"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Privacy and Scaling Explorations</div></div></div></footer></div>
</body>
</html>